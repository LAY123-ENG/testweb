<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Merry Christmas</title>
  <style>
    /* Your existing CSS */
  </style>
</head>
<body>
  <div id="mask">🎄</div>
  <canvas id="stars"></canvas>
  <div class="main">
    <!-- Your SVG and other HTML content -->
  </div>

  <!-- Include GSAP and Plugins -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/MotionPathPlugin.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/DrawSVGPlugin.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/MorphSVGPlugin.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/Physics2DPlugin.min.js"></script>

  <!-- Custom Scripts -->
  <script>
    function snow() {
      // Your existing snow function
    }
    snow();

    // Your existing GSAP animation setup
    MorphSVGPlugin.convertToPath("polygon");
    var xmlns = "http://www.w3.org/2000/svg",
        xlinkns = "http://www.w3.org/1999/xlink",
        select = function (s) {
          return document.querySelector(s);
        },
        selectAll = function (s) {
          return document.querySelectorAll(s);
        },
        pContainer = select(".pContainer"),
        mainSVG = select(".mainSVG"),
        star = select("#star"),
        sparkle = select(".sparkle"),
        tree = select("#tree"),
        showParticle = true,
        particleColorArray = [
          "#E8F6F8",
          "#ACE8F8",
          "#F6FBFE",
          "#A2CBDC",
          "#B74551",
          "#5DBA72",
          "#910B28",
          "#910B28",
          "#446D39",
        ],
        particleTypeArray = ["#star", "#circ", "#cross", "#heart"],
        particlePool = [],
        particleCount = 0,
        numParticles = 201;

    gsap.set("svg", {
      visibility: "visible",
    });

    gsap.set(sparkle, {
      transformOrigin: "50% 50%",
      y: -100,
    });

    let getSVGPoints = (path) => {
      let arr = [];
      var rawPath = MotionPathPlugin.getRawPath(path)[0];
      rawPath.forEach((el, value) => {
        let obj = {};
        obj.x = rawPath[value * 2];
        obj.y = rawPath[value * 2 + 1];
        if (value % 2) {
          arr.push(obj);
        }
      });
      return arr;
    };
    let treePath = getSVGPoints(".treePath");
    var treeBottomPath = getSVGPoints(".treeBottomPath");

    var mainTl = gsap.timeline({ delay: 0, repeat: 0 }), starTl;

    function flicker(p) {
      gsap.killTweensOf(p, { opacity: true });
      gsap.fromTo(
        p,
        { opacity: 1 },
        { duration: 0.07, opacity: Math.random(), repeat: -1 }
      );
    }

    function createParticles() {
      var i = numParticles, p, step = numParticles / treePath.length;
      while (--i > -1) {
        p = select(particleTypeArray[i % particleTypeArray.length]).cloneNode(true);
        mainSVG.appendChild(p);
        p.setAttribute("fill", particleColorArray[i % particleColorArray.length]);
        p.setAttribute("class", "particle");
        particlePool.push(p);
        gsap.set(p, { x: -100, y: -100, transformOrigin: "50% 50%" });
      }
    }

    var getScale = gsap.utils.random(0.5, 3, 0.001, true);

    function playParticle(p) {
      if (!showParticle) return;
      var p = particlePool[particleCount];
      gsap.set(p, {
        x: gsap.getProperty(".pContainer", "x"),
        y: gsap.getProperty(".pContainer", "y"),
        scale: getScale(),
      });
      var tl = gsap.timeline();
      tl.to(p, {
        duration: gsap.utils.random(0.61, 6),
        physics2D: {
          velocity: gsap.utils.random(-23, 23),
          angle: gsap.utils.random(-180, 180),
          gravity: gsap.utils.random(-6, 50),
        },
        scale: 0,
        rotation: gsap.utils.random(-123, 360),
        ease: "power1",
        onStart: flicker,
        onStartParams: [p],
        onRepeat: (p) => {
          gsap.set(p, { scale: getScale() });
        },
        onRepeatParams: [p],
      });
      particleCount++;
      particleCount = particleCount >= numParticles ? 0 : particleCount;
    }

    function drawStar() {
      starTl = gsap.timeline({ onUpdate: playParticle });
      starTl
        .to(".pContainer, .sparkle", {
          duration: 6,
          motionPath: { path: ".treePath", autoRotate: false },
          ease: "linear",
        })
        .to(".pContainer, .sparkle", {
          duration: 1,
          onStart: function () { showParticle = false; },
          x: treeBottomPath[0].x,
          y: treeBottomPath[0].y,
        })
        .to(".pContainer, .sparkle", {
          duration: 2,
          onStart: function () { showParticle = true; },
          motionPath: { path: ".treeBottomPath", autoRotate: false },
          ease: "linear",
        }, "-=0")
        .from(".treeBottomMask", {
          duration: 2,
          drawSVG: "0% 0%",
          stroke: "#FFF",
          ease: "linear",
        }, "-=2");
    }

    function drawMain() {
      mainTl
        .from([".treePathMask", ".treePotMask"], {
          duration: 6,
          drawSVG: "0% 0%",
          stroke: "#FFF",
          stagger: { each: 6 },
          duration: gsap.utils.wrap([6, 1, 2]),
          ease: "linear",
        })
        .from(".treeStar", {
          duration: 3,
          scaleY: 0,
          scaleX: 0.15,
          transformOrigin: "50% 50%",
          ease: "elastic(1,0.5)",
        }, "-=4")
        .to(".sparkle", {
          duration: 3,
          opacity: 0,
          ease: "rough({strength: 2, points: 100, template: linear, taper: both, randomize: true, clamp: false})",
        }, "-=0")
        .to(".treeStarOutline", {
          duration: 1,
          opacity: 0.3,
          ease: "rough({strength: 2, points: 16, template: linear, taper: none, randomize: true, clamp: false})",
        }, "+=1");
    }

    function drawStars() {
      let canvas = document.getElementById("stars"),
          ctx = canvas.getContext("2d"),
          w = (canvas.width = window.innerWidth),
          h = (canvas.height = window.innerHeight),
          hue = 37,
          stars = [],
          count = 0,
          maxStars = 1300;

      var canvas2 = document.createElement("canvas"),
          ctx2 = canvas2.getContext("2d");
      canvas2.width = 100;
      canvas2.height = 100;
      var half = canvas2.width / 2,
          gradient2 = ctx2.createRadialGradient(half, half, 0, half, half, half);
      gradient2.addColorStop(0.025, "#CCC");
      gradient2.addColorStop(0.1, "hsl(" + hue + ", 61%, 10%)");
      gradient2.addColorStop(0.25, "hsl(" + hue + ", 64%, 2%)");
      gradient2.addColorStop(1, "transparent");
      ctx2.fillStyle = gradient2;
      ctx2.beginPath();
      ctx2.arc(half, half, half, 0, Math.PI * 2);
      ctx2.fill();

      function random(min, max) {
        if (arguments.length < 2) {
          max = min;
          min = 0;
        }
        if (min > max) {
          var hold = max;
          max = min;
          min = hold;
        }
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function maxOrbit(x, y) {
        var max = Math.max(x, y),
            diameter = Math.round(Math.sqrt(max * max + max * max));
        return diameter / 2;
      }

      var Star = function () {
        this.orbitRadius = random(maxOrbit(w, h));
        this.radius = random(60, this.orbitRadius) / 8;
        this.orbitX = w / 2;
        this.orbitY = h / 2;
        this.timePassed = random(0, maxStars);
        this.speed = random(this.orbitRadius) / 50000;
        this.alpha = random(2, 10) / 10;
        count++;
        stars[count] = this;
      };

      Star.prototype.draw = function () {
        var x = Math.sin(this.timePassed) * this.orbitRadius + this.orbitX,
            y = Math.cos(this.timePassed) * this.orbitRadius + this.orbitY,
            twinkle = random(10);
        if (twinkle === 1 && this.alpha > 0) {
          this.alpha -= 0.05;
        } else if (twinkle === 2 && this.alpha < 1) {
          this.alpha += 0.05;
        }
        ctx.globalAlpha = this.alpha;
        ctx.drawImage(canvas2, x - this.radius / 2, y - this.radius / 2, this.radius, this.radius);
        this.timePassed += this.speed;
      };

      for (var i = 0; i < maxStars; i++) {
        new Star();
      }

      function animation() {
        ctx.globalCompositeOperation = "source-over";
        ctx.globalAlpha = 0.9;
        ctx.fillStyle = "hsla(" + hue + ", 64%, 6%, 2)";
        ctx.fillRect(0, 0, w, h);
        ctx.globalCompositeOperation = "lighter";
        for (var i = 1, l = stars.length; i < l; i++) {
          stars[i].draw();
        }
        window.requestAnimationFrame(animation);
      }

      animation();
    }

    let myLabels = [
      "祝俞俞~",
      "圣诞快乐乐乐乐乐乐乐",
      "天天开心！！！",
      "永远爱你呦！！！",
    ];

    function init() {
      let element = document.getElementById("header");
      for (let i = 0; i < myLabels.length; i++) {
        let _p = document.createElement("p");
        _p.className = "header-item";
        _p.innerHTML = myLabels[i];
        element.appendChild(_p);
      }

      let labels = document.getElementsByClassName('header-item');
      for (let i = 0; i < myLabels.length; i++) {
        setTimeout(() => {
          labels[i].classList.add("show");
        }, 1000 * i);
      }
    }

    init();
    createParticles();
    drawStar();
    drawMain();
    mainTl.add(starTl, 0);
    gsap.globalTimeline.timeScale(1.5);
    drawStars();
  </script>
</body>
</html>
